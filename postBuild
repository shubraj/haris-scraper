#!/bin/bash
set -e

echo "ğŸš€ Starting Streamlit Cloud deployment setup..."

# Ensure pip is up-to-date
echo "ğŸ“¦ Upgrading pip..."
python -m pip install --upgrade pip

# Install Playwright browser binaries
echo "ğŸŒ Installing Playwright browsers..."
python -m playwright install chromium
python -m playwright install-deps chromium

# Verify Tesseract installation
echo "ğŸ” Verifying Tesseract OCR installation..."
tesseract --version || echo "âš ï¸  Tesseract not found, but continuing..."

# Create necessary directories
echo "ğŸ“ Creating application directories..."
mkdir -p logs
mkdir -p downloads
mkdir -p temp

# Set proper permissions
echo "ğŸ” Setting permissions..."
chmod 755 logs
chmod 755 downloads
chmod 755 temp

# Verify Python packages
echo "âœ… Verifying Python packages..."
python -c "import streamlit, requests, pandas, bs4, playwright, openai, fitz, pytesseract, PIL; print('All packages imported successfully')"

echo "ğŸ‰ Streamlit Cloud deployment setup completed!"